<app-navbar></app-navbar>
<ul class="nav nav-tabs" id="myTab" role="tablist">
  <!-- <li class="nav-item" role="presentation">
    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#home">Add/Manage Employees</button>
  </li> -->
  <li class="nav-item" role="presentation">
    <button class="nav-link" data-bs-toggle="tab" routerLink="/profile">Profile</button>
  </li>
  <!-- dropdown we have to work -->
   <li class="nav-item" role="presentation">
    <div class="dropdown">
      <button class="nav-link dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
        View
      </button>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton">
            <li class="nav-item" role="presentation">
              <button class="dropdown-item" data-bs-toggle="tab" data-bs-target="#profile8">Assign Tasks</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="dropdown-item" data-bs-toggle="tab" data-bs-target="#profile5">View Today's Status</button>
            </li>
          </ul>
        </div>
      </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#profile5">Today's Status</button>
  </li>
</ul>
<br>
<div class="tab-content mt-3">
   <div class="tab-pane fade" id="profile17">
     <div class="container profile-form">
    <h2 class="form-title">Your Profile</h2>
    <form (ngSubmit)="UpdateProfile()">
      <div class="row mb-3">
        <div class="col-md-4">
          <label class="form-label">First Name</label>
          <input type="text" [value]="profile[0].firstname"[(ngModel)]="firstname" name="firstname" class="form-control" placeholder="First Name" required >
        </div>
        <div class="col-md-4">
          <label class="form-label">Middle Name</label>
          <input type="text"[value]="profile[0].middlename"[(ngModel)]="middlename" name="middlename" class="form-control" placeholder="Middle Name">
        </div>
        <div class="col-md-4">
          <label class="form-label">Last Name</label>
          <input type="text"[value]="profile[0].lastname" class="form-control"[(ngModel)]="lastname" name="lastname" placeholder="Last Name" required>
        </div>
      </div>

      <div class="row mb-3">
        <div class="col-md-4">
          <label class="form-label">Date of Birth</label>
          <input type="date"[value]="profile[0].dob" class="form-control" name="dob" [(ngModel)]="dob" required>
        </div>
        <div class="col-md-4">
          <label class="form-label">PAN</label>
          <input type="text"[value]="profile[0].pan" class="form-control" name="pan" [(ngModel)]="pan" required>
        </div>
        <div class="col-md-4">
          <label class="form-label">UAN</label>
          <input type="text" class="form-control"[value]="profile[0].uan" name="uan" [(ngModel)]="uan" required>
        </div>
      </div>

      <div class="mb-3">
        <label class="form-label">Date of Joining</label>
        <input type="date"[value]="profile[0].doj" name="doj" class="form-control"[(ngModel)]="doj" required>
      </div>

      <div class="mb-3">
        <label class="form-label">Address</label>
        <textarea class="form-control"[value]="profile[0].address" name="address" [(ngModel)]="address" rows="3" placeholder="Your full address" required ></textarea>
      </div>

      <div class="row mb-3">
        <div class="col-md-4">
          <label class="form-label">Emergency Contact Number</label>
          <input type="tel" class="form-control" name="emergency" [value]="profile[0].emergency"[(ngModel)]="emergency" required>
        </div>
        <div class="col-md-4">
          <label class="form-label">Relation</label>
          <input type="text"name="relation" class="form-control"[value]="profile[0].relation"[(ngModel)]="relation" placeholder="e.g. Father, Spouse" required>
        </div>
        <div class="col-md-4">
          <label class="form-label">Blood Group</label>
          <input type="text"[value]="profile[0].bloodgroup"list="bloodgrouplist" class="form-control"name="bloodgroup" required [(ngModel)]="bloodgroup" placeholder="Blood group" required>
            <datalist id="bloodgrouplist">
              <option value="A+">
              <option value="A-">
              <option value="B+">
              <option value="B-">
              <option value="O+">
              <option value="O-">
              <option value="AB+">
              <option value="AB-">
            </datalist>
        </div>
      </div>
      <div class="d-grid">
        <button type="submit" class="btn btn-primary btn-lg">Update Profile</button>
      </div>
    </form>
  </div>
  </div>
  <div class="tab-pane fade show active" id="profile5">
      <div *ngIf="tasksWithNames.length > 0; else noTasks">
    <h3>Today's Tasks Assigned by You</h3>
    <div  style="display: flex;justify-content: center; vertical-align: middle; gap: 10px; padding: 15px; border: 2px solid #ffffff; border-radius: 10px; background-color: #ffffff;">
            <input type="text"style="width: 120px;" class="form-control" [(ngModel)]="filters.group" list="groupList" (focus)="getFilteredGroups()"placeholder="Filter Groups">
            <input type="text"class="form-control"style="width: 300px;" [(ngModel)]="filters.client" list="clientList" (focus)="getFilteredClients()"placeholder="Filter Clients">
            <input type="text"class="form-control"style="width: 300px;" [(ngModel)]="filters.description"list="descriptionlist"  placeholder="Filter Description" (focus)="getFilteredDescription()" />
            <input type="text"class="form-control"style="width: 300px;" [(ngModel)]="filters.assignedToName"list="AssignedToList"  placeholder="Filter Ops"(focus)="getFilteredAssignedTo()" />
            <input type="text" class="form-control"style="width: 120px;" [(ngModel)]="filters.status"  list="StatusList" placeholder="Filter Status" (focus)="getFilteredStatus()"/> 
        </div>
    <table class="table table-striped table-bordered">
      <thead>
        <tr>
          <th>
            Group
            <datalist id="groupList">
              <option *ngFor="let value of filterGroups" [value]="value"></option>
            </datalist>
          </th>
          <th>
            Client
            <datalist id="clientList">
              <option *ngFor="let value of filterClients" [value]="value"></option>
            </datalist>
          </th>
          <th>Period</th>
          <th>
            Description
            <datalist id="descriptionlist">
              <option *ngFor="let value of filterDescription" [value]="value"></option>
            </datalist>
          </th>
          <th>
            Assigned To
            <datalist id="AssignedToList">
              <option *ngFor="let value of filterAssignedTo" [value]="value"></option>
            </datalist>
          </th>
          <th>
            Deadline
          </th>
          <th>
            Status
            <datalist id="StatusList">
              <option *ngFor="let value of filterStatus" [value]="value"></option>
            </datalist>
          </th>
          <th>Actions</th>
          <th>
            Comments
            <datalist id="StatusList">
              <option *ngFor="let value of filterStatus" [value]="value"></option>
            </datalist>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let task of filteredTasks()">
          <ng-container *ngIf="isTaskDueTodayOrEarlier(task.deadline)&& task.status != 'Completed'">
            <td>{{ task.group }}</td>
            <td>{{ task.client }}</td>
            <td>{{ task.period }}</td>
            <td>{{ task.description }}</td>
            <td>{{ task.assignedToName }}</td>
            <td>{{ task.deadline | date: 'dd-MM-yyyy h:mm a' }}</td>
            <td>{{ task.status }}</td>
            <td>
              <!-- <button (click)="deleteTask(task.id)" class="btn btn-dark">Delete</button> -->
              <button (click)="openEditModal(task)" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#updateTaskModal">Update</button>
            </td>
            <td>{{ task.comment }}</td>
          </ng-container>
        </tr>
      </tbody>
    </table>
  </div>
  <br>
    <div *ngIf="tasksWithNames.length > 0; else noTasks">
    <h3>Your Today's Tasks</h3>
    <div  style="display: flex;justify-content: center; vertical-align: middle; gap: 10px; padding: 15px; border: 2px solid #ffffff; border-radius: 10px; background-color: #ffffff;">
            <input type="text"style="width: 120px;" class="form-control" [(ngModel)]="filters.group" list="groupList" (focus)="getFilteredGroups()"placeholder="Filter Groups">
            <input type="text"class="form-control"style="width: 300px;" [(ngModel)]="filters.client" list="clientList" (focus)="getFilteredClients()"placeholder="Filter Clients">
            <input type="text"class="form-control"style="width: 300px;" [(ngModel)]="filters.description"list="descriptionlist"  placeholder="Filter Description" (focus)="getFilteredDescription()" />
            <input type="text"class="form-control"style="width: 300px;" [(ngModel)]="filters.assignedToName"list="AssignedToList"  placeholder="Filter Ops"(focus)="getFilteredAssignedTo()" />
            <input type="text" class="form-control"style="width: 120px;" [(ngModel)]="filters.status"  list="StatusList" placeholder="Filter Status" (focus)="getFilteredStatus()"/> 
        </div>
    <table class="table table-striped table-bordered">
      <thead>
        <tr>
          <th>
            Group
            <datalist id="groupList">
              <option *ngFor="let value of filterGroups" [value]="value"></option>
            </datalist>
          </th>
          <th>
            Client
            <datalist id="clientList">
              <option *ngFor="let value of filterClients" [value]="value"></option>
            </datalist>
          </th>
          <th>Period</th>
          <th>
            Description
            <datalist id="descriptionlist">
              <option *ngFor="let value of filterDescription" [value]="value"></option>
            </datalist>
          </th>
          <th>
            Assigned To
            <datalist id="AssignedToList">
              <option *ngFor="let value of filterAssignedTo" [value]="value"></option>
            </datalist>
          </th>
          <th>
            Deadline
          </th>
          <th>
            Status
            <datalist id="StatusList">
              <option *ngFor="let value of filterStatus" [value]="value"></option>
            </datalist>
          </th>
          <th>Actions</th>
          <th>
            Comments
            <datalist id="StatusList">
              <option *ngFor="let value of filterStatus" [value]="value"></option>
            </datalist>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let task of filteredTasks()">
          <ng-container *ngIf="isTaskDueTodayOrEarlier(task.deadline)&& task.assignedTo == managerId"else noTasks>
            <td>{{ task.group }}</td>
            <td>{{ task.client }}</td>
            <td>{{ task.period }}</td>
            <td>{{ task.description }}</td>
            <td>{{ task.assignedToName }}</td>
            <td>{{ task.deadline | date: 'dd-MM-yyyy h:mm a' }}</td>
            <td>{{ task.status }}</td>
            <td>
                <div class="dropdown">
                  <button  class="btn-select-lookalike" type="button"id="taskActionsDropdown"
                    data-bs-toggle="dropdown"aria-expanded="false" style="width: 70px; height: 30px;">
                  </button>
                  <ul class="dropdown-menu" aria-labelledby="taskActionsDropdown">
                    <li>
                      <a class="dropdown-item"(click)="openEditModal(task)"data-bs-toggle="modal"data-bs-target="#updateTaskModal">
                        Update
                      </a>
                    </li>
                    <li>
                      <a class="dropdown-item"(click)="markTaskasComplete(task)">
                        Mark as Complete
                      </a>
                    </li>
                  </ul>
                </div>
              <!-- <button (click)="deleteTask(task.id)" class="btn btn-dark">Delete</button> -->
            </td>
            <td>{{ task.comment }}</td>
          </ng-container>
        </tr>
      </tbody>
    </table>
  </div>
  <ng-template #noTasks>
    <p>No tasks assigned yet.</p>
  </ng-template>
 <!-- Bootstrap Modal for Updating Task -->
<div class="modal fade" id="updateTaskModal" tabindex="-1" aria-labelledby="updateTaskModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="updateTaskModalLabel">Update Task</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- Task Description -->
        <div>
          <label for="">Client Name:</label>
          <input type="text" class="form-control" id="taskDescription"[(ngModel)]="editTaskClient" [value]="Client">
        </div>
        <div class="mb-3">
          <label for="editDescription" class="form-label">Task Description:</label>
          <textarea class="form-control" id="editDescription" [(ngModel)]="editTaskDescription"></textarea>
        </div>

        <!-- Assign To -->
        <div class="mb-3">
          <label for="editMember" class="form-label">Assign To:</label>
          <select id="editMember" class="form-control" [(ngModel)]="editSelectedMemberId">
            <option *ngFor="let member of membersWithNames" [value]="member.id">
              {{ member.name }}
            </option>
          </select>
        </div>

        <!-- Deadline -->
        <div class="mb-3">
          <label for="editDeadline" class="form-label">Deadline:</label>
          <input id="editDeadline" type="datetime-local" class="form-control" [(ngModel)]="editTaskDeadline" [min]="editTaskDeadline | date:'yyyy-MM-ddTHH:mm'">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-success"data-bs-dismiss="modal" (click)="updateTask()">Save Changes</button>
      </div>
    </div>
  </div>
</div>
<br>
<div class="accordion" id="accordion3">
  <div class="accordion-item">
    <h2 class="accordion-header">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
        View Tomorrow's Tasks
      </button>
    </h2>
    <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
      <div class="accordion-body">
        <div *ngIf="tasksWithNames.length > 0; else noTasks">
          <h3>Tomorrows Tasks Assigned by You</h3>
          <table class="table table-striped table-bordered">
            <thead>
              <tr>
                <th>Group</th>
                <th>Client</th>
                <th>Period</th>
                <th>Description</th>
                <th>Assigned To</th>
                <th>Deadline</th>
                <th>Status</th>
                <th>Actions</th>
                <th>Comments</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let task of tasksWithNames">
               <ng-container *ngIf="isTaskDueTomorrowOrEarlier(task.deadline)&& task.status != 'Completed'">
                <td>{{ task.group }}</td>
                <td>{{ task.client }}</td>
                <td>{{ task.period }}</td>
                <td>{{ task.description }}</td>
                <td>{{ task.assignedToName }}</td>
                <td>{{ task.deadline | date: ' dd-MM-yyyy h:mm:ss a, EEE' }}</td>
                <td>{{ task.status }}</td>
                <td>
                  <!-- <button (click)="deleteTask(task.id)" class="btn btn-danger">Delete</button> -->
                  <button (click)="openEditModal(task)" class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#updateTaskModal">Update</button>
                </td>
                <td>{{ task.comment }}</td>
              </ng-container>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
  </div>
  <div class="tab-pane fade" id="profile8">
        <div>
          <h2>Assign Tasks to Executives</h2>
          <!-- Team Selection -->
          <label for="teamSelect">Select Team:</label>
          <select id="teamSelect">
            <option *ngFor="let team of teams" [value]="team.id">
              {{ team.name }}
            </option>
          </select>
          <!-- Team Members -->
      <div *ngIf="teamMembers.length > 0">
        <label for="memberSelect">Assign To:</label>
        <select  id="memberSelect" [(ngModel)]="selectedMemberId">
          <option *ngFor="let member of membersWithNames" [value]="member.id">
            {{ member.name }}
          </option>
        </select>
      </div>
      <div>
        <label for="">Group Name:</label>
        <input type="text" class="form-control" id="Client"[(ngModel)]="GroupName" list="GroupList">
        <datalist id="GroupList">
          <option *ngFor="let value of AllClientsAndGroups" [value]="value.groupName">
        </datalist>
      </div>
      <div>
        <label for="">Client Name:</label>
        <input type="text" class="form-control" id="Client"[(ngModel)]="ClientName" list="ClientList">
        <datalist id="ClientList">
          <option *ngFor="let value of AllClientsAndGroups" [value]="value.clientName">
        </datalist>
      </div>
          <!-- Task Description -->
          <div>
            <label for="taskDescription">Task Description:</label>
            <input  type="text"class="form-control" list="dropdownOptions" id="taskDescription"[(ngModel)]="taskDescription" rows="3" cols="50">
              <datalist id="dropdownOptions">
                <option value="Payroll Input Received">
                <option value="Payroll Processing">
                <option value="Payroll Reports to QC">
                <option value="Payroll reports sent to client">
                <option value="Customer Approves the Payroll Reports">
                <option value="Bank file">
                <option value="Upload individual IT report on UKG portal">
                <option value="Statutory reports sent to QC">
                <option value="Statutory reports sent to client">
                <option value="Check PAN of new joiner on Traces">
                <option value="Send new joiner details to compliance team to generate UAN number">
                <option value="ESIC return (Even Nil)">
                <option value="PF return (IW)">
                <option value="PT return">
                <option value="Payslip, IT Sheet, FnF on ESS Portal">
              </datalist>
          </div>
          
          <!-- Deadline -->
          <div>
            <label for="taskDeadline">Deadline:</label>
            <input class="form-control"
              id="taskDeadline" 
              type="datetime-local" 
              [(ngModel)]="taskDeadline" 
              [min]="minDeadline"
            />
          </div>
          <button (click)="assignTask()" class="btn btn-primary">Assign Task</button>
      </div>
      <br>
      <div class="accordion" id="accordion4">
  <div class="accordion-item">
    <h2 class="accordion-header">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
        Upload Pay Calendar
      </button>
    </h2>
    <div id="collapseThree" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
      <div class="accordion-body">
        <div>
          <div>
            <h2>Assign Tasks By Uploading Pay Calendar</h2>
          
            <label for="teamSelect">Select Team:</label>
            <select id="teamSelect" [(ngModel)]="selectedTeamId">
              <option *ngFor="let team of teams" [value]="team.id">
                {{ team.name }}
              </option>
            </select>
          
            <div *ngIf="teamMembers.length > 0">
              <label for="memberSelect">Assign To:</label>
              <select id="memberSelect" [(ngModel)]="selectedMemberId">
                <option *ngFor="let member of membersWithNames" [value]="member.id">
                  {{ member.name }}
                </option>
              </select>
            </div>
          
            <div>
              <label for="Client">Group Name:</label>
              <input type="text" class="form-control" id="Client" [(ngModel)]="GroupName" list="GroupList">
            </div>
            <div>
              <label for="Client">Client Name:</label>
              <input type="text" class="form-control" id="Client" [(ngModel)]="ClientName" list="ClientList">
            </div>
          
            <div>
              <label for="taskFile">Upload Task File:</label>
              <input type="file" id="taskFile" (change)="onFileChange($event)" accept=".xlsx, .xls" />
            </div>
          
            <button (click)="assignTasksFromExcel()" class="btn btn-primary">
              Assign Tasks
            </button>
          </div>
          </div>
      </div>
    </div>
  </div>
      </div>
  </div>
</div>
<br>


